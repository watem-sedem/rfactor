

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Application of rfactor on data det Flanders &mdash; rfactor 0.1.3.post1.dev48+gfd47197 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=12b58453"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
      <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
      <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Code legacy" href="../codelegacy.html" />
    <link rel="prev" title="rfactor package" href="../api/rfactor.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            rfactor
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../rfactor.html">R-factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../get-started.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/modules.html">Module Reference</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Application on Flanders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../codelegacy.html">Code legacy</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../conduct.html">Code of conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelog.html">Changelog</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">rfactor</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Application of rfactor on data det Flanders</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/watem-sedem/rfactor/blob/master/docs/notebooks/analysis_flanders.ipynb" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
<section id="Application-of-rfactor-on-data-det-Flanders">
<h1>Application of rfactor on data det Flanders<a class="headerlink" href="#Application-of-rfactor-on-data-det-Flanders" title="Link to this heading"></a></h1>
<section id="Aim">
<h2>Aim<a class="headerlink" href="#Aim" title="Link to this heading"></a></h2>
<p>Implementation to compute and analyse the R-factor of the RUSLE-equation. The R-factor is a measure for the total erosivity of a number of rainfall events within a defined timeframe (year, month, number of days). The factor is computed by calculating the yearly sum of -for every rainfall event- the sum of the depth of rainfall (mm) and the kinetic energy, and taking the mean over all years.</p>
<table class="docutils align-default">
<tbody>
<tr class="row-odd"><td><p><strong>NOTE</strong></p></td>
</tr>
<tr class="row-even"><td><p>This notebook does not
include the erosivity
computation based on the
Royal Meteorological
Institute of Belgium
(RMI) rainfall data, as
the data is not
available as open data.
One can contact RMI to
obtain the rainfall
input data.
Alternatively, the
results of the
computation of the
erosivity values based
on the RMI data are
provided in this
notebook as well as
other rainfall input
data, so one can proceed
with the analysis.</p></td>
</tr>
</tbody>
</table>
</section>
<section id="Package-imports">
<h2>Package imports<a class="headerlink" href="#Package-imports" title="Link to this heading"></a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</pre></div>
</div>
</div>
<p>Load the <code class="docutils literal notranslate"><span class="pre">rfactor</span></code> package functionalities</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">rfactor</span><span class="w"> </span><span class="kn">import</span> <span class="n">compute_erosivity</span><span class="p">,</span> <span class="n">maximum_intensity_matlab_clone</span><span class="p">,</span> <span class="n">rain_energy_verstraeten2006</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rfactor.process</span><span class="w"> </span><span class="kn">import</span> <span class="n">load_rain_folder</span> <span class="p">,</span> <span class="n">load_rain_file_matlab_legacy</span><span class="p">,</span> <span class="n">compute_rainfall_statistics</span><span class="p">,</span> <span class="n">get_rfactor_station_year</span>
</pre></div>
</div>
</div>
</section>
<section id="Input-data-and-compute-erosivity">
<h2>Input data and compute erosivity<a class="headerlink" href="#Input-data-and-compute-erosivity" title="Link to this heading"></a></h2>
<p><strong>Set folders</strong></p>
<p>The main function <code class="docutils literal notranslate"><span class="pre">compute_erosivity</span></code> requires a <a class="reference external" href="https://pandas.pydata.org/docs/index.html">pandas DataFrame</a> containing <strong>non-zero</strong> rainfall data with the following columns:</p>
<ul class="simple">
<li><p>datetime (pd.Timestamp): Time stamp</p></li>
<li><p>rain_mm (float): Rain in mm</p></li>
<li><p>station (str): Measurement station identifier</p></li>
</ul>
<p>However, the legacy format of the input files used in the original Matlab implementation is still supported as well. For this format, te input files are defined by text files (extension: <code class="docutils literal notranslate"><span class="pre">txt</span></code>) that hold <strong>non-zero rainfall</strong> timeseries. The data are split per station and per year with a specific data file tag <code class="docutils literal notranslate"><span class="pre">STATION_YYYY</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>KMI_6414_2004.txt
KMI_6414_2005.txt
...
KMI_6434_2003.txt
KMI_6434_2004.txt
...
</pre></div>
</div>
<p><strong>Note</strong>: the files in <code class="docutils literal notranslate"><span class="pre">tests/data/test_rainfalldata</span></code> are an incomplete data set for Belgium (RMI rainfall data are not included), an alternative is provided in the section ‘Analysis’.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fmap_rainfall</span> <span class="o">=</span>  <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;../../tests/data/test_rainfalldata&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Use the <code class="docutils literal notranslate"><span class="pre">load_rain_folder</span></code> function to read all rain data in a folder:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_rainfall</span> <span class="o">=</span> <span class="n">load_rain_folder</span><span class="p">(</span><span class="n">fmap_rainfall</span><span class="p">,</span> <span class="n">load_rain_file_matlab_legacy</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_rainfall</span>
</pre></div>
</div>
</div>
<p><strong>Compute rainfall statistics</strong> (and add station metadata)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/stations.csv&quot;</span><span class="p">)</span>

<span class="n">rain_stats</span> <span class="o">=</span> <span class="n">compute_rainfall_statistics</span><span class="p">(</span><span class="n">all_rainfall</span><span class="p">,</span> <span class="n">stations</span><span class="p">)</span>
<span class="n">rain_stats</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><strong>Select stations to compute erosivity for</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">consider_stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/files.csv&quot;</span><span class="p">)</span>

<span class="n">sel_rainfall</span> <span class="o">=</span> <span class="n">all_rainfall</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">all_rainfall</span><span class="p">[</span><span class="s2">&quot;tag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">consider_stations</span><span class="p">[</span><span class="s2">&quot;datafile&quot;</span><span class="p">])]</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sel_rainfall</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><strong>Run Model</strong></p>
<p>It needs to be decided which calculation functions are used to compute the <code class="docutils literal notranslate"><span class="pre">rain</span> <span class="pre">energy</span> <span class="pre">depth</span></code> and <code class="docutils literal notranslate"><span class="pre">maximum</span> <span class="pre">intensity</span></code>. There are a few implemented functions available in the package for which we choose the <code class="docutils literal notranslate"><span class="pre">rain_energy_verstraeten</span></code> and <code class="docutils literal notranslate"><span class="pre">maximum_intensity</span></code> by default. The <code class="docutils literal notranslate"><span class="pre">maximum_intensity</span></code> function follows a slightly different approach to the original Matlab implementation. However, one can opt to use the <code class="docutils literal notranslate"><span class="pre">matlab_clone</span></code> method as well, which is a Python implementation mimicking the
original Matlab one:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">erosivity</span> <span class="o">=</span> <span class="n">compute_erosivity</span><span class="p">(</span><span class="n">all_rainfall</span><span class="p">,</span> <span class="n">rain_energy_verstraeten2006</span><span class="p">,</span> <span class="n">maximum_intensity_matlab_clone</span><span class="p">)</span>
<span class="n">erosivity</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Users can choose to implement their own custom function and apply it, e.g.</p>
<p>```python def rain_energy_per_unit_depth_brown_and_foster(rain): “””Calculate rain energy per unit depth according to Brown and Foster.</p>
</section>
<section id="Parameters">
<h2>Parameters<a class="headerlink" href="#Parameters" title="Link to this heading"></a></h2>
<p>rain : numpy.ndarray Rain (mm)</p>
</section>
<section id="Returns">
<h2>Returns<a class="headerlink" href="#Returns" title="Link to this heading"></a></h2>
<p>energy : float Energy per unit depth.</p>
</section>
<section id="Notes">
<h2>Notes<a class="headerlink" href="#Notes" title="Link to this heading"></a></h2>
<p>The rain energy per unit depth :math:<code class="docutils literal notranslate"><span class="pre">e_r</span></code> (:math:<code class="docutils literal notranslate"><span class="pre">\\text{J}.\\text{mm}^{-1}.</span> <span class="pre">\\text{m}^{-2}</span></code>) is defined by Brown and Foster (1987) and Renard et al. (1997)</p>
<div class="math notranslate nohighlight">
\[\]</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>e_r = 29*(1-0.72*exp(-0.05*i_r)
</pre></div>
</div>
<p>with</p>
<ul class="simple">
<li><p>:math:<code class="docutils literal notranslate"><span class="pre">i_r</span></code> the rain intensity for every 10-min increment (mm :math:<code class="docutils literal notranslate"><span class="pre">\\text{h}^{-1}</span></code> ).</p></li>
</ul>
</section>
<section id="References">
<h2>References<a class="headerlink" href="#References" title="Link to this heading"></a></h2>
<p>Brown, L.C., Foster, G.R., 1987. Storm erosivity using idealized intensity distributions. Transactions of the ASAE 30, 0379–0386. <a class="reference external" href="https://doi.org/10.13031/2013.31957">https://doi.org/10.13031/2013.31957</a>.</p>
<p>Renard, K.G., Foster, G.R., Weesies, G.A., McCool, D.K., Yoder, D.C., 1997, Predicting soil erosion by water: a guide to conservation planning with the revised universal soil loss equation (RUSLE), Agriculture Handbook. U.S. Department of Agriculture, Washington. <a class="reference external" href="https://www.ars.usda.gov/ARSUserFiles/64080530/RUSLE/AH_703.pdf">https://www.ars.usda.gov/ARSUserFiles/64080530/RUSLE/AH_703.pdf</a></p>
<p>“”” rain_energy = 29 * (1 - 0.72 * np.exp(-0.05<em>rain</em>6))*rain return rain_energy.sum()</p>
</section>
<section id="Analysis">
<h2>Analysis<a class="headerlink" href="#Analysis" title="Link to this heading"></a></h2>
<p>If one does not have acces to the RMI data, the output erosivity from the computation with the full data set is provided in this repository as an alternative:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">erosivity</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/erosivity_belgium.csv&quot;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">erosivity</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><strong>Ukkel</strong></p>
<p>Compute R-factor for specific periods for Ukkel (KMI_6447 and KMI_F3).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">timeseries</span> <span class="o">=</span> <span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">1898</span><span class="p">,</span> <span class="mi">2003</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">range</span><span class="p">(</span><span class="mi">2003</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">range</span><span class="p">(</span><span class="mi">1898</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">range</span><span class="p">(</span><span class="mi">1996</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">range</span><span class="p">(</span><span class="mi">1991</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">range</span><span class="p">(</span><span class="mi">1990</span><span class="p">,</span> <span class="mi">2001</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
              <span class="nb">range</span><span class="p">(</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span>

<span class="k">for</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">timeseries</span><span class="p">:</span>
    <span class="n">rfactor</span> <span class="o">=</span> <span class="n">get_rfactor_station_year</span><span class="p">(</span><span class="n">erosivity</span><span class="p">,[</span><span class="s2">&quot;KMI_6447&quot;</span><span class="p">,</span><span class="s2">&quot;KMI_FS3&quot;</span><span class="p">],</span> <span class="n">period</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R-factor for period from </span><span class="si">{</span><span class="n">period</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> till </span><span class="si">{</span><span class="n">period</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> is: </span><span class="si">{</span><span class="n">rfactor</span><span class="p">[</span><span class="s1">&#39;erosivity_cum&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p><strong>Make a figure for Ukkel</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rfactor_all</span><span class="o">=</span> <span class="n">get_rfactor_station_year</span><span class="p">(</span><span class="n">erosivity</span><span class="p">,</span> <span class="n">stations</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;KMI_FS3&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI_6447&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">))</span>

<span class="n">rfactor_fs3</span> <span class="o">=</span> <span class="n">get_rfactor_station_year</span><span class="p">(</span><span class="n">erosivity</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;KMI_FS3&quot;</span><span class="p">])</span>
<span class="n">rfactor_fs3</span> <span class="o">=</span> <span class="n">rfactor_fs3</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">rfactor_fs3</span><span class="p">[</span><span class="s2">&quot;erosivity_cum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>

<span class="n">rfactor_6447</span> <span class="o">=</span> <span class="n">get_rfactor_station_year</span><span class="p">(</span><span class="n">erosivity</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;KMI_6447&quot;</span><span class="p">])</span>
<span class="n">rfactor_6447</span> <span class="o">=</span> <span class="n">rfactor_6447</span><span class="p">[</span><span class="o">~</span><span class="p">(</span><span class="n">rfactor_6447</span><span class="p">[</span><span class="s2">&quot;erosivity_cum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">())]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>

<span class="c1"># add first line of KMI6447 to end of KMI FS3 in order to make a continuous timeseries on the plot</span>
<span class="n">rfactor_fs3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">rfactor_fs3</span><span class="p">,</span><span class="n">rfactor_6447</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rfactor_fs3</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">rfactor_fs3</span><span class="p">[</span><span class="s2">&quot;erosivity_cum&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;KMI_FS3 (1898-2002)&quot;</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rfactor_6447</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">rfactor_6447</span><span class="p">[</span><span class="s2">&quot;erosivity_cum&quot;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;KMI_6447 (2003-2020)&quot;</span><span class="p">)</span>

<span class="c1"># rolling mean</span>
<span class="n">rfactor_all</span> <span class="o">=</span> <span class="n">get_rfactor_station_year</span><span class="p">(</span><span class="n">erosivity</span><span class="p">,</span> <span class="n">stations</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;KMI_FS3&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI_6447&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
<span class="n">windows</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">]</span>
<span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">rfactor_all</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">)[</span><span class="s2">&quot;erosivity_cum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rfactor_all</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Moving average (</span><span class="si">{</span><span class="n">window</span><span class="si">}</span><span class="s2"> year window)&quot;</span><span class="p">)</span>


<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">3500</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">1890</span><span class="p">,</span><span class="mi">2020</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Yearly R-factor [MJ mm ha$^{-1}$ h$^{-1}$ year$^{-1}$]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">16</span><span class="p">})</span>
</pre></div>
</div>
</div>
<p><strong>All stations except for Ukkel</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stations_belgium_excl_ukkel</span> <span class="o">=</span> <span class="p">[</span><span class="n">station</span> <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span>
                               <span class="k">if</span> <span class="n">station</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;KMI_6447&quot;</span><span class="p">,</span><span class="s2">&quot;KMI_FS3&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI1990_2002&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI2003_nu_v2&quot;</span><span class="p">]]</span>
<span class="n">years</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1898</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span> <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span>
         <span class="n">erosivity</span><span class="p">[</span><span class="n">erosivity</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">stations_belgium_excl_ukkel</span><span class="p">)][</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>

<span class="n">rfactor_non_ukkel</span> <span class="o">=</span> <span class="n">get_rfactor_station_year</span><span class="p">(</span><span class="n">erosivity</span><span class="p">,</span>
                                             <span class="n">stations</span><span class="o">=</span><span class="n">stations_belgium_excl_ukkel</span><span class="p">,</span>
                                             <span class="n">years</span><span class="o">=</span><span class="n">years</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rfactor_non_ukkel</span><span class="p">[</span><span class="s2">&quot;erosivity_cum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">len</span><span class="p">(</span><span class="n">rfactor_non_ukkel</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p><strong>All stations flanders</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stations_flanders</span> <span class="o">=</span> <span class="p">[</span><span class="n">station</span> <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span>
                     <span class="k">if</span> <span class="n">station</span> <span class="ow">not</span> <span class="ow">in</span>  <span class="p">[</span><span class="s2">&quot;KMI_6447&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI_FS3&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI_6455&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI_6459&quot;</span><span class="p">,</span>
                                         <span class="s2">&quot;KMI_6472&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI_6494&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI_6484&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI1990_2002&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI2003_nu_v2&quot;</span><span class="p">]]</span>
<span class="n">years</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1898</span><span class="p">,</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span> <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span>
         <span class="n">erosivity</span><span class="p">[</span><span class="n">erosivity</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">stations_flanders</span><span class="p">)][</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>

<span class="n">rfactor_flanders</span> <span class="o">=</span> <span class="n">get_rfactor_station_year</span><span class="p">(</span><span class="n">erosivity</span><span class="p">,</span><span class="n">stations_flanders</span><span class="p">,</span> <span class="n">years</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rfactor_flanders</span><span class="p">[</span><span class="s2">&quot;erosivity_cum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">len</span><span class="p">(</span><span class="n">rfactor_flanders</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p><strong>Plot the distribution of all R-values for Belgium, excluding the data from Ukkel</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="n">year</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1991</span><span class="p">,</span> <span class="mi">2021</span><span class="p">)</span> <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span>
         <span class="n">erosivity</span><span class="p">[</span><span class="n">erosivity</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">stations_belgium_excl_ukkel</span><span class="p">)][</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()]</span>

<span class="n">rfactor_non_ukkel</span> <span class="o">=</span> <span class="n">get_rfactor_station_year</span><span class="p">(</span><span class="n">erosivity</span><span class="p">,</span> <span class="n">stations_belgium_excl_ukkel</span><span class="p">,</span> <span class="n">years</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">rfactor_non_ukkel</span><span class="p">[</span><span class="s2">&quot;erosivity_cum&quot;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.8</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Jaarlijkse waarden voor alle 55 stations in België&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1239</span><span class="p">,</span> <span class="mi">1239</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">120</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ukkel (30-jaar referentie periode)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;R-waarde [MJ mm ha$^{-1}$ h$^{-1}$ jaar$^{-1}$]&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">180</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p><strong>All stations of the VMM (Flanders)</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stations_vmm</span> <span class="o">=</span> <span class="p">[</span><span class="n">station</span> <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;KMI&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">station</span><span class="p">]</span>

<span class="n">rfactor_vmm</span> <span class="o">=</span> <span class="n">get_rfactor_station_year</span><span class="p">(</span><span class="n">erosivity</span><span class="p">,</span> <span class="n">stations_vmm</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">rfactor_vmm</span><span class="p">[</span><span class="s2">&quot;erosivity_cum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
<span class="nb">len</span><span class="p">(</span><span class="n">rfactor_vmm</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>
</div>
</div>
<p><strong>Compute values per year over all stations</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">get_rfactor_station_year</span><span class="p">(</span><span class="n">erosivity</span><span class="p">)</span>
 <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">)</span>
 <span class="o">.</span><span class="n">aggregate</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;erosivity_cum&quot;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">],</span>
     <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="s2">&quot;count&quot;</span><span class="p">})</span>
 <span class="o">.</span><span class="n">sort_values</span><span class="p">((</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;count&#39;</span><span class="p">),</span> <span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
 <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="Analysis-(monthly-resolution)">
<h2>Analysis (monthly resolution)<a class="headerlink" href="#Analysis-(monthly-resolution)" title="Link to this heading"></a></h2>
<p>Get the EI30-values for 2018 based on two Ukkel station (“KMI_6447”,”KMI_FS3”)</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">erosivity_monthly</span> <span class="o">=</span> <span class="p">(</span><span class="n">erosivity</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">erosivity</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s2">&quot;KMI_6447&quot;</span><span class="p">,</span> <span class="s2">&quot;KMI_FS3&quot;</span><span class="p">]),</span> <span class="s2">&quot;erosivity&quot;</span><span class="p">]</span>
                     <span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">)</span>
                     <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
                     <span class="o">.</span><span class="n">to_frame</span><span class="p">())</span>
<span class="n">erosivity_monthly</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">erosivity_monthly</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span>
<span class="n">erosivity_monthly</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Get mean and interquartile range of monthly R-factor</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">em</span> <span class="o">=</span> <span class="p">(</span><span class="n">erosivity_monthly</span>
      <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;month&quot;</span><span class="p">)</span>
      <span class="o">.</span><span class="n">aggregate</span><span class="p">({</span>
          <span class="s2">&quot;erosivity&quot;</span><span class="p">:[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span>
                       <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
                       <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">75</span><span class="p">)]</span>
      <span class="p">}))</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">em</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s2">&quot;erosivity&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
<span class="n">em</span><span class="p">[</span><span class="s2">&quot;l_e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s2">&quot;erosivity&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">em</span><span class="p">[</span><span class="s2">&quot;erosivity&quot;</span><span class="p">][</span><span class="s2">&quot;&lt;lambda_0&gt;&quot;</span><span class="p">]</span>
<span class="n">em</span><span class="p">[</span><span class="s2">&quot;u_e&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">em</span><span class="p">[</span><span class="s2">&quot;erosivity&quot;</span><span class="p">][</span><span class="s2">&quot;&lt;lambda_1&gt;&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">em</span><span class="p">[</span><span class="s2">&quot;erosivity&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p><strong>Plot</strong></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">em</span><span class="p">))</span>
<span class="n">y_gv</span> <span class="o">=</span> <span class="p">[</span><span class="mi">26</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">77</span><span class="p">,</span> <span class="mi">144</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">68</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">32</span><span class="p">]</span>
<span class="n">y_gv2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">35</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">36</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">177</span><span class="p">,</span> <span class="mi">135</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">66</span><span class="p">,</span> <span class="mi">48</span><span class="p">,</span> <span class="mi">43</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span><span class="n">em</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">],</span><span class="n">yerr</span><span class="o">=</span><span class="n">em</span><span class="p">[[</span><span class="s2">&quot;l_e&quot;</span><span class="p">,</span><span class="s2">&quot;u_e&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">values</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.80</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Ukkel (1898-2020))&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y_gv</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Verstraeten $\it{et. al}$ (2001)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="o">+</span><span class="mf">0.3</span><span class="p">,</span><span class="n">y_gv2</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.2</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Verstraeten $\it{et. al}$ (2006)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;R-value&quot;</span><span class="p">)</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">axes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">x</span><span class="p">,[</span><span class="s2">&quot;Januari&quot;</span><span class="p">,</span><span class="s2">&quot;Februari&quot;</span><span class="p">,</span><span class="s2">&quot;Maart&quot;</span><span class="p">,</span><span class="s2">&quot;April&quot;</span><span class="p">,</span><span class="s2">&quot;Mei&quot;</span><span class="p">,</span><span class="s2">&quot;Juni&quot;</span><span class="p">,</span><span class="s2">&quot;Juli&quot;</span><span class="p">,</span><span class="s2">&quot;Augustus&quot;</span><span class="p">,</span><span class="s2">&quot;September&quot;</span><span class="p">,</span><span class="s2">&quot;Oktober&quot;</span><span class="p">,</span><span class="s2">&quot;November&quot;</span><span class="p">,</span><span class="s2">&quot;December&quot;</span><span class="p">],</span><span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">facecolor</span> <span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;R-waarde [MJ mm ha$^{-1}$ h$^{-1}$ maand$^{-1}$]&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
</section>
<section id="Additional:-monthly-analysis-(detail)">
<h2>Additional: monthly analysis (detail)<a class="headerlink" href="#Additional:-monthly-analysis-(detail)" title="Link to this heading"></a></h2>
<p><strong>Evolution monthly R-value</strong></p>
<p>Generate plot to analyse evolution of montly R over the years</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">subplot_montlhy_R</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">ind1</span><span class="p">,</span><span class="n">ind2</span><span class="p">):</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">ind1</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ind2</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;erosivity&quot;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;EI30&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;erosivity&quot;</span><span class="p">],</span><span class="n">color</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">]</span><span class="o">*</span><span class="mi">3</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">([</span><span class="mi">1998</span><span class="p">,</span><span class="mi">2021</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="c1"># rolling mean</span>
    <span class="n">scales</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">scales</span><span class="p">:</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;erosivity&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">scale</span><span class="o">==</span><span class="mi">10</span><span class="p">:</span>
            <span class="n">y_max</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">*</span><span class="mf">1.1</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;voortschrijdend gemiddelde (</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s1"> jaar)&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ind1</span><span class="o">!=</span><span class="mi">3</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ind2</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Jaar (-)&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">500</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ind2</span><span class="o">!=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ind1</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\t\t\t</span><span class="s1"> Maandelijkse R [MJ mm ha$^{-1}$ h$^{-1}$ maand$^{-1}$]&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ind1</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ind2</span><span class="o">==</span><span class="mi">2</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mi">9</span><span class="p">])</span>
<span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Januari&quot;</span><span class="p">,</span><span class="s2">&quot;Februari&quot;</span><span class="p">,</span><span class="s2">&quot;Maart&quot;</span><span class="p">,</span><span class="s2">&quot;April&quot;</span><span class="p">,</span><span class="s2">&quot;Mei&quot;</span><span class="p">,</span><span class="s2">&quot;Juni&quot;</span><span class="p">,</span><span class="s2">&quot;Juli&quot;</span><span class="p">,</span><span class="s2">&quot;Augustus&quot;</span><span class="p">,</span><span class="s2">&quot;September&quot;</span><span class="p">,</span><span class="s2">&quot;Oktober&quot;</span><span class="p">,</span><span class="s2">&quot;November&quot;</span><span class="p">,</span><span class="s2">&quot;December&quot;</span><span class="p">]</span>
<span class="n">erosivity_monthly</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">erosivity_monthly</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span>

<span class="k">for</span> <span class="n">month</span><span class="p">,</span><span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">months</span><span class="p">):</span>
    <span class="n">ind1</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">month</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
    <span class="n">ind2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">month</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">df_plot</span> <span class="o">=</span> <span class="n">erosivity_monthly</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">erosivity_monthly</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span><span class="o">==</span><span class="n">month</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">df_plot</span>  <span class="o">=</span> <span class="n">df_plot</span> <span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">df_plot</span><span class="p">[</span><span class="s2">&quot;erosivity&quot;</span><span class="p">])]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span>
    <span class="n">subplot_montlhy_R</span><span class="p">(</span><span class="n">df_plot</span><span class="p">,</span><span class="n">ax</span><span class="p">[</span><span class="n">ind1</span><span class="p">,</span><span class="n">ind2</span><span class="p">],</span><span class="n">ind1</span><span class="p">,</span><span class="n">ind2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../api/rfactor.html" class="btn btn-neutral float-left" title="rfactor package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../codelegacy.html" class="btn btn-neutral float-right" title="Code legacy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Sacha Gobeyn.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>